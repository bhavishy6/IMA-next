{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport IMALayout from '../components/IMALayout';\nimport IMARecentSalesChart from '../components/IMARecentSalesChart';\nimport fetch from 'isomorphic-unfetch';\nimport IMANewSaleForm from '../components/forms/IMANewSale';\n\nvar moment = require('moment');\n\nmoment().format('L');\n\nconst Dashboard = props => {\n  return __jsx(IMALayout, null, __jsx(\"div\", null, \"form to add new sale form to add new customer form to add new inventory item1\", __jsx(\"p\", null, \"recent sales since 30 days ago: \", JSON.stringify(props.recentSalesByDateDict)), __jsx(\"div\", {\n    style: {\n      height: 500 + \"px\",\n      width: 500 + 'px'\n    }\n  }, __jsx(IMARecentSalesChart, {\n    data: getMostRecentSalesNIVO(props.recentSalesByDateDict)\n  }))), __jsx(IMANewSaleForm, null));\n};\n\nDashboard.getInitialProps = async ctx => {\n  const res = await fetch('http://localhost:3000/api/sales?daysAgo=' + 30);\n  const json = await res.json();\n  console.log(`Show data fetched. ${JSON.stringify(json)}`);\n  var mostRecentSales = getMostRecentSalesDict(json);\n  console.log(JSON.stringify(mostRecentSales[0]));\n  return {\n    recentSalesByDateDict: mostRecentSales\n  };\n};\n\nfunction getMostRecentSalesDict(sales) {\n  var recentSales = {};\n  sales.forEach((sale, index) => {\n    console.log(index + \":\" + sale[\"date\"]);\n    var date = moment(sale[\"date\"]).format(\"L\");\n    var quantities = sale[\"quantities\"]; // console.log(JSON.stringify(quantities))\n\n    if (recentSales[date]) {\n      console.log('this date exists' + date);\n      recentSales[date].forEach((product, index) => {\n        // console.log(\"existing product name for this day: \" + product['name'])\n        var sameProduct = findProductInQuantities(product[\"name\"], quantities);\n        console.log(JSON.stringify(sameProduct));\n\n        if (sameProduct === null) {} else {\n          // console.log(\"found same product: \" + JSON.stringify(product) + product['qty'] +\"+\\n \" + JSON.stringify(sameProduct))\n          product[\"qty\"] += sameProduct[\"qty\"];\n        }\n      }, recentSales[date]);\n    } else {\n      //this date does not yet exist in recentSales\n      recentSales[date] = sale[\"quantities\"];\n    }\n  });\n  console.log(\"map:  \" + JSON.stringify(recentSales) + \"232323\");\n  return recentSales;\n}\n\n;\n\nfunction getMostRecentSalesNIVO(recentSalesDict) {\n  var recentSales = [];\n  Object.keys(recentSalesDict).forEach(function (date, index) {\n    var salesOnDate = recentSalesDict[date];\n    recentSales.push({});\n    recentSales[index]['date'] = date;\n\n    for (var i = 0; i < salesOnDate.length; i++) {\n      recentSales[index][salesOnDate[i]['name']] = salesOnDate[i]['qty'];\n\n      switch (salesOnDate[i]['name']) {\n        case 'Iron Sheet':\n          recentSales[index]['Iron SheetColor'] = \"hsl(129, 70%, 50%)\";\n          break;\n\n        case 'Copper Sheet':\n          recentSales[index]['Copper SheetColor'] = \"hsl(77, 70%, 50%)\";\n          break;\n      }\n    }\n  });\n  console.log(\"recentNIVO: \" + JSON.stringify(recentSales));\n  return recentSales;\n}\n\nfunction findProductInQuantities(name, quantities) {\n  var foundProduct = null;\n  quantities.forEach((product, index) => {\n    console.log(name + \"checking product name: \" + product['name']);\n\n    if (name == product['name']) {\n      console.log('true' + JSON.stringify(product));\n      foundProduct = product;\n    }\n  });\n  return foundProduct;\n}\n\nexport default Dashboard;","map":null,"metadata":{},"sourceType":"module"}