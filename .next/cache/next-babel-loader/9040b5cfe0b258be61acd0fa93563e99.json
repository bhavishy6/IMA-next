{"ast":null,"code":"import nextConnect from 'next-connect';\nimport middleware from '../../middleware/database';\n\nvar moment = require('moment');\n\nmoment().format('L');\nconst handler = nextConnect();\nhandler.use(middleware);\nhandler.get(async (req, res) => {\n  const {\n    daysAgo\n  } = req.query; // console.log(this.state);\n\n  var startDateExists = true;\n  var dbQuery = {};\n\n  if (startDateExists) {\n    var startDateFilter = moment().subtract(daysAgo, 'days');\n    dbQuery = {\n      \"date\": {\n        $gte: new Date(startDateFilter._d)\n      }\n    };\n  }\n\n  let doc = await req.db.collection('sales').find(dbQuery).toArray();\n  console.log(doc);\n  res.json(doc);\n  res.end();\n});\nhandler.post(async (req, res) => {\n  let data = req.body;\n  data = JSON.parse(data); // console.log(\"Post: \"+ data)\n\n  data.date = new Date(data.date).setHours(1);\n  let doc = await req.db.collection('sales').insertOne(data, function (err, res) {\n    if (err) throw err;\n    console.log(\"1 document inserted\");\n  });\n});\nexport default handler;","map":{"version":3,"sources":["C:/Users/bhavi/Documents/Coding/IMA-next/pages/api/sales.js"],"names":["nextConnect","middleware","moment","require","format","handler","use","get","req","res","daysAgo","query","startDateExists","dbQuery","startDateFilter","subtract","$gte","Date","_d","doc","db","collection","find","toArray","console","log","json","end","post","data","body","JSON","parse","date","setHours","insertOne","err"],"mappings":"AAAA,OAAOA,WAAP,MAAwB,cAAxB;AACA,OAAOC,UAAP,MAAuB,2BAAvB;;AAEA,IAAIC,MAAM,GAAIC,OAAO,CAAC,QAAD,CAArB;;AACAD,MAAM,GAAGE,MAAT,CAAgB,GAAhB;AAEA,MAAMC,OAAO,GAAGL,WAAW,EAA3B;AACAK,OAAO,CAACC,GAAR,CAAYL,UAAZ;AAEAI,OAAO,CAACE,GAAR,CAAY,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC5B,QAAM;AAAEC,IAAAA;AAAF,MAAcF,GAAG,CAACG,KAAxB,CAD4B,CAE5B;;AACA,MAAIC,eAAe,GAAG,IAAtB;AACA,MAAIC,OAAO,GAAG,EAAd;;AACA,MAAID,eAAJ,EAAqB;AACjB,QAAIE,eAAe,GAAGZ,MAAM,GAAGa,QAAT,CAAkBL,OAAlB,EAA2B,MAA3B,CAAtB;AACAG,IAAAA,OAAO,GAAG;AACN,cAAQ;AACJG,QAAAA,IAAI,EAAE,IAAIC,IAAJ,CAASH,eAAe,CAACI,EAAzB;AADF;AADF,KAAV;AAKH;;AAED,MAAIC,GAAG,GAAG,MAAMX,GAAG,CAACY,EAAJ,CAAOC,UAAP,CAAkB,OAAlB,EAA2BC,IAA3B,CAAgCT,OAAhC,EAAyCU,OAAzC,EAAhB;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYN,GAAZ;AACAV,EAAAA,GAAG,CAACiB,IAAJ,CAASP,GAAT;AACAV,EAAAA,GAAG,CAACkB,GAAJ;AACH,CAlBD;AAmBAtB,OAAO,CAACuB,IAAR,CAAa,OAAOpB,GAAP,EAAYC,GAAZ,KAAoB;AAC7B,MAAIoB,IAAI,GAAGrB,GAAG,CAACsB,IAAf;AACAD,EAAAA,IAAI,GAAGE,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAP,CAF6B,CAG7B;;AACAA,EAAAA,IAAI,CAACI,IAAL,GAAY,IAAIhB,IAAJ,CAASY,IAAI,CAACI,IAAd,EAAoBC,QAApB,CAA6B,CAA7B,CAAZ;AACA,MAAIf,GAAG,GAAG,MAAMX,GAAG,CAACY,EAAJ,CAAOC,UAAP,CAAkB,OAAlB,EAA2Bc,SAA3B,CAAqCN,IAArC,EAA2C,UAASO,GAAT,EAAc3B,GAAd,EAAmB;AAC1E,QAAI2B,GAAJ,EAAS,MAAMA,GAAN;AACTZ,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACD,GAHa,CAAhB;AAIH,CATD;AAUA,eAAepB,OAAf","sourcesContent":["import nextConnect from 'next-connect';\r\nimport middleware from '../../middleware/database';\r\n\r\nvar moment  = require('moment')\r\nmoment().format('L'); \r\n\r\nconst handler = nextConnect();\r\nhandler.use(middleware);\r\n\r\nhandler.get(async (req, res) => {\r\n    const { daysAgo } = req.query;\r\n    // console.log(this.state);\r\n    var startDateExists = true;\r\n    var dbQuery = {};\r\n    if (startDateExists) {\r\n        var startDateFilter = moment().subtract(daysAgo, 'days');\r\n        dbQuery = {\r\n            \"date\": {\r\n                $gte: new Date(startDateFilter._d)\r\n            }\r\n        };\r\n    }\r\n\r\n    let doc = await req.db.collection('sales').find(dbQuery).toArray();\r\n    console.log(doc);\r\n    res.json(doc);\r\n    res.end();\r\n});\r\nhandler.post(async (req, res) => {\r\n    let data = req.body\r\n    data = JSON.parse(data);\r\n    // console.log(\"Post: \"+ data)\r\n    data.date = new Date(data.date).setHours(1)\r\n    let doc = await req.db.collection('sales').insertOne(data, function(err, res) {\r\n        if (err) throw err;\r\n        console.log(\"1 document inserted\");\r\n      });\r\n});\r\nexport default handler;"]},"metadata":{},"sourceType":"module"}