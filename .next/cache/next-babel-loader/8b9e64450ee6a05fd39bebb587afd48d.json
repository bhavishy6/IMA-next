{"ast":null,"code":"import { MongoClient } from 'mongodb';\nimport nextConnect from 'next-connect'; // const MongoClient = require('mongodb').MongoClient;\n// const client = new MongoClient(uri, { useNewUrlParser: true });\n// client.connect(err => {\n//   const collection = client.db(\"test\").collection(\"devices\");\n//   // perform actions on the collection object\n//   client.close();\n// });\n\nconst uri = \"mongodb+srv://admin:<ima_db_admin__>@imacluster-pof9k.mongodb.net/test?retryWrites=true&w=majority\";\nconst client = new MongoClient(uri, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\n\nasync function database(req, res, next) {\n  if (!client.isConnected()) await client.connect();\n  req.dbClient = client;\n  req.db = client.db('IMA');\n  return next();\n}\n\nconst middleware = nextConnect();\nmiddleware.use(database);\nexport default middleware;","map":{"version":3,"sources":["C:/Users/bhavi/Documents/Coding/IMA-next/middleware/database.js"],"names":["MongoClient","nextConnect","uri","client","useNewUrlParser","useUnifiedTopology","database","req","res","next","isConnected","connect","dbClient","db","middleware","use"],"mappings":"AAAA,SAASA,WAAT,QAA4B,SAA5B;AACA,OAAOC,WAAP,MAAwB,cAAxB,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMC,GAAG,GAAG,oGAAZ;AAEA,MAAMC,MAAM,GAAG,IAAIH,WAAJ,CAAgBE,GAAhB,EAAqB;AAChCE,EAAAA,eAAe,EAAE,IADe;AAEhCC,EAAAA,kBAAkB,EAAE;AAFY,CAArB,CAAf;;AAKE,eAAeC,QAAf,CAAwBC,GAAxB,EAA6BC,GAA7B,EAAkCC,IAAlC,EAAwC;AACtC,MAAI,CAACN,MAAM,CAACO,WAAP,EAAL,EAA2B,MAAMP,MAAM,CAACQ,OAAP,EAAN;AAC3BJ,EAAAA,GAAG,CAACK,QAAJ,GAAeT,MAAf;AACAI,EAAAA,GAAG,CAACM,EAAJ,GAASV,MAAM,CAACU,EAAP,CAAU,KAAV,CAAT;AACA,SAAOJ,IAAI,EAAX;AACD;;AAED,MAAMK,UAAU,GAAGb,WAAW,EAA9B;AAEAa,UAAU,CAACC,GAAX,CAAeT,QAAf;AAEA,eAAeQ,UAAf","sourcesContent":["import { MongoClient } from 'mongodb';\r\nimport nextConnect from 'next-connect';\r\n\r\n// const MongoClient = require('mongodb').MongoClient;\r\n// const client = new MongoClient(uri, { useNewUrlParser: true });\r\n// client.connect(err => {\r\n//   const collection = client.db(\"test\").collection(\"devices\");\r\n//   // perform actions on the collection object\r\n//   client.close();\r\n// });\r\n\r\nconst uri = \"mongodb+srv://admin:<ima_db_admin__>@imacluster-pof9k.mongodb.net/test?retryWrites=true&w=majority\";\r\n\r\nconst client = new MongoClient(uri, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true,\r\n  });\r\n  \r\n  async function database(req, res, next) {\r\n    if (!client.isConnected()) await client.connect();\r\n    req.dbClient = client;\r\n    req.db = client.db('IMA');\r\n    return next();\r\n  }\r\n  \r\n  const middleware = nextConnect();\r\n  \r\n  middleware.use(database);\r\n  \r\n  export default middleware;"]},"metadata":{},"sourceType":"module"}